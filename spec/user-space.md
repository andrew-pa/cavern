# Cavern Basic User Space

## Components

### Services
- "the egg"
    - bootstraps the system
    - starts the ramdisk driver (from the ramdisk)
        - could just *be* the ramdisk driver
    - spawns the resource registery
    - spawns/supervises root supervisor
    - starts drivers based on device tree
- Resource Registery
    - maintain unified namespace for resources
    - allows for service discovery
- Supervisor
    - spawn processes from a configuration
    - send children initial configuration information
    - restart children on exit based on policy
- Logging
    - Collector
        - collects logs from the rest of the system (including the kernel)
        - distributes log events to sinks
    - Serial Console Sink
        - formats/prints log events to vTTY
- virtual TTY

### Drivers
- UART
- in-memory file system for initial ramdisk

## Basic RPC Protocol
System services follow this RPC protocol for message sending.

Each message has a header that contains:

- a 4-bit standard message type. Current value are: Request, ProxiedRequest, Response, Notification.
- a 28-bit message opcode. This is interpreted by the receiver, and should determine the exact procedure/method invoked for Requests/Notifications and the result code (ok/error) for Responses.
- a 32-bit correlation ID.
    This value is generated by senders of Requests, and copied to the relevant Response that is sent back.
    This field is unspecified for Notifications and should be available for applications.
- for ProxiedRequests, the process and thread IDs to send the response to (64-bits total, 32-bits each).
